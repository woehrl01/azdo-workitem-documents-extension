variables:
  isMain: $[eq(variables['Build.SourceBranch'], 'refs/heads/main')]
  version: $[format('1.1.{0}', variables['Build.BuildId'])]
  npm_config_cache: $(Pipeline.Workspace)/.npm

pool:
    vmImage: 'ubuntu-18.04'

stages:
- stage: Dev
  condition: eq(variables.isMain, 'false')
  jobs:
  - job: Publish
    steps:
    - template: azure-pipelines.template.yml
      parameters:
        buildPostfix: ':dev'
        PAT: $(PUBLISH_TOKEN)
        AdditionalCommandArgs: '--share-with $(DEV_TEAM)'
        Version: $(version)
        BaseUri: $(DEV_BASE_URI)

- stage: Prod
  condition: eq(variables.isMain, 'true')
  jobs:
  - job: Publish
    steps:
    - template: azure-pipelines.template.yml
      parameters:
        PAT: $(PUBLISH_TOKEN)
        Version: $(version)
