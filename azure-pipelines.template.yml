parameters:
- name: buildPostfix 
  type: string
  default: ''
- name: AdditionalCommandArgs 
  type: string
  default: ''
- name: BaseUri 
  type: string
  default: ''

steps:
- task: NodeTool@0
  inputs:
    versionSpec: '16.x'
  displayName: 'Use Node.js@16.x'

- script: npm install -g npm@8.7
  displayName: 'Use NPM@8.7.x'

- script: npm ci
  displayName: 'Install dependencies'

- script: npm run build${{ parameters.buildPostfix }}
  displayName: 'Run build'

- script: |
    npm run publish-extension${{ parameters.buildPostfix }} -- -t "$(PUBLISH_TOKEN)" --override '{"version":"$(version)","baseUri":"${{ parameters.BaseUri }}"}' ${{ parameters.AdditionalCommandArgs }}
  displayName: 'Publish extension'
